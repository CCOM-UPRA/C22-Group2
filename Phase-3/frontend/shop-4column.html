<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <!--=====================================
                    META TAG PART START
        =======================================-->
    <!-- REQUIRE META -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- AUTHOR META -->
    <meta name="author" content="mironcoder">
    <meta name="email" content="mironcoder@gmail.com">
    <meta name="profile" content="https://themeforest.net/user/mironcoder">

    <!-- TEMPLATE META -->
    <meta name="name" content="Greeny">
    <meta name="title" content="Greeny - eCommerce HTML Template">
    <meta name="keywords"
        content="organic, food, shop, ecommerce, store, html, bootstrap, template, agriculture, vegetables, webshop, farm, grocery, natural, online store">
    <!--=====================================
                    META-TAG PART END
        =======================================-->

    <!-- WEBPAGE TITLE -->
    <title>Shop - Urban Gardens</title>

    <!--=====================================
                    CSS LINK PART START
        =======================================-->
    <!-- FAVICON -->
    <link rel="icon" href="{{url_for('static', filename='images/logo_pagina.png')}}">

    <!-- FONTS -->
    <link rel="stylesheet" href="{{url_for('static', filename='fonts/flaticon/flaticon.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='fonts/icofont/icofont.min.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='fonts/fontawesome/fontawesome.min.css')}}">

    <!-- VENDOR -->
    <link rel="stylesheet" href="{{url_for('static', filename='vendor/venobox/venobox.min.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='vendor/slickslider/slick.min.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='vendor/niceselect/nice-select.min.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='vendor/bootstrap/bootstrap.min.css')}}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- CUSTOM -->
    <link rel="stylesheet" href="{{url_for('static', filename='css/main.css')}}">

    <!-- URBAN GARDENS css-->
    <link rel="stylesheet" href="{{url_for('static',filename='css/urban-gardens.css')}}">


    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
    <!--=====================================
                    CSS LINK PART END
        =======================================-->
</head>

<body ng-app="">
    <div class="backdrop"></div>
    <a class="backtop fas fa-arrow-up" href="#"></a>



    <!--=====================================
                    HEADER PART START
        =======================================-->
    {% include 'header.html' %}
    <!--=====================================
                    HEADER PART END
        =======================================-->


    <!--=====================================
                  CART SIDEBAR PART START
        =======================================-->
    {% include 'cart.html' %}
    <!--=====================================
                    CART SIDEBAR PART END
        =======================================-->


    <!--=====================================
                    BANNER PART START
        =======================================-->
    {% include 'banner.html' %}

    <!--=====================================
                    BANNER PART END
        =======================================-->


    <!--=====================================
                    SHOP PART START
        =======================================-->
    <section class="inner-section shop-part">
        <div class="container">
            <div class="row content-reverse">

                <div class="col-lg-3">
                    <form id="filters-form" action="{{url_for('shop')}}" method="GET">


                        <div class="shop-widget">
                            <h6 class="shop-widget-title">Sorting By</h6>
                            <ul class="shop-widget-list">

                                {% for s in sortings %}
                                <li>
                                    <div class="shop-widget-content">
                                        <input type="checkbox" id="sorting-{{ loop.index }}" name="sortings"
                                            value="{{s}}">
                                        <label for="sorting-{{ loop.index }}">{{s}}</label>

                                    </div>

                                </li>
                                {% endfor %}
                            </ul>
                            <ul class="shop-widget-list">
                                <h6 class="shop-widget-title">Order By</h6>

                                {% for o in sortByOrder %}

                                <ul>
                                    <li>
                                        <div class="shop-widget-content">
                                            <input type="radio" id="order-{{ loop.index }}" name="sorting-order"
                                                value="{{o}}">
                                            <label for="order-{{ loop.index }}">{{o}}</label>
                                        </div>

                                    </li>
                                    {% endfor %}

                                </ul>
                                <button class="shop-widget-btn" type="submit" value="sortings">
                                    <i class="fas fa-search"></i>
                                    <span>Sort</span>
                                </button>
                        </div>


                        <div class="shop-widget">
                            <h6 class="shop-widget-title">Filter by Recommended Location</h6>
                            <ul class="shop-widget-list">

                                {% for location in locations %}
                                <li>
                                    <div class="shop-widget-content">
                                        <input type="checkbox" id="location-{{ loop.index }}" name="locations"
                                            value="{{location.get('location')}}">
                                        <label for="location-{{ loop.index }}">{{location.get('location')}}</label>
                                    </div>

                                </li>
                                {% endfor %}
                            </ul>
                            <button class="shop-widget-btn" type="submit" value="locations">
                                <i class="fas fa-search"></i>
                                <span>Search by Recommended location</span>
                            </button>
                        </div>


                        <div class="shop-widget">
                            <h6 class="shop-widget-title">Filter by Plant type</h6>
                            <ul class="shop-widget-list">

                                {% for plants in plantType %}
                                <li>
                                    <div class="shop-widget-content">
                                        <input type="checkbox" id="plant-{{ loop.index }}" name="plant-types"
                                            value="{{plants.get('plant_type')}}">
                                        <label for="plant-{{ loop.index }}">{{plants.get('plant_type')}}</label>
                                    </div>

                                </li>
                                {% endfor %}

                            </ul>
                            <button class="shop-widget-btn" type="submit" value="plant-types">
                                <i class="fas fa-search"></i>
                                <span>Search by Plant type</span>
                            </button>
                        </div>


                        <div class="shop-widget">
                            <h6 class="shop-widget-title">Filter by Recommended sun exposure</h6>
                            <ul class="shop-widget-list">

                                {% for s in sun %}
                                <li>
                                    <div class="shop-widget-content">
                                        <input type="checkbox" id="sun-{{ loop.index }}" name="sun-exps"
                                            value="{{s.get('sun_exp')}}">
                                        <label for="sun-{{ loop.index }}">{{s.get('sun_exp')}}</label>
                                    </div>

                                </li>
                                {% endfor %}

                            </ul>
                            <button class="shop-widget-btn" type="submit" value="sun-exps">
                                <i class="fas fa-search"></i>
                                <span>Search by Sun exposure</span>
                            </button>
                        </div>


                        <div class="shop-widget">
                            <h6 class="shop-widget-title">Filter by Recommended watering</h6>
                            <ul class="shop-widget-list">

                                {% for w in watering %}
                                <li>
                                    <div class="shop-widget-content">
                                        <input type="checkbox" id="water-{{ loop.index }}" name="waterings"
                                            value="{{w.get('watering')}}">
                                        <label for="water-{{ loop.index }}">{{w.get('watering')}}</label>
                                    </div>

                                </li>
                                {% endfor %}

                            </ul>
                            <button class="shop-widget-btn" type="submit" value="waterings">
                                <i class="fas fa-search"></i>
                                <span>Search by Watering</span>
                            </button>
                        </div>


                        <div class="shop-widget">
                            <button class="shop-widget-btn" type="submit" value="all">
                                <i class="fas fa-search"></i>
                                <span>Search by All Filters</span>
                            </button>
                        </div>

                    </form>
                </div>

                <div class="col-lg-9">
                    <div class="row">
                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-3 row-cols-xl-4">
                            {% for product in products %}
                            <div class="one-product">
                                <div class="col">
                                    <div class="product-card">
                                        <div class="product-media">

                                            <a class="product-image"
                                                href="static/images/product-images/{{product['image']}}">
                                                <img src="static/images/product-images/{{product['image']}}"
                                                    alt="product">
                                            </a>
                                            <div class="product-widget">
                                                <a title="Product View" href="#" class="fas fa-eye"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#product-view-{{product['product_id']}}"></a>
                                            </div>
                                        </div>
                                        <div class="product-content">
                                            <h6 class="product-name">
                                                {{product['name']}}
                                            </h6>
                                            <h6 class="product-price">
                                                <span>${{product['price']}}</span>
                                            </h6>
                                            {% if product['stock'] > 0 %}
                                            <button class="product-add" title="Add to Cart">
                                                <i class="fas fa-shopping-basket"></i>
                                                <span>add</span>
                                            </button>
                                            {% else %}
                                            <p style="color:red">Out of Stock</p>
                                            {% endif %}
                                            <div class="product-action">
                                                <form action="{{url_for('addcart')}}" method="POST">
                                                    <input style="width: 50%" class="action-input"
                                                        title="Quantity Number" type="number" id="quantity"
                                                        name="quantity" value="1" min="1" max="{{product['stock']}}"
                                                        onkeyup=enforceMinMax(this)>

                                                    <input type="hidden" id="p_id" name="p_id"
                                                        value="{{product['product_id']}}">

                                                    <input style="width: 30%" type="submit" value="Add">
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="modal fade" id="product-view-{{product['product_id']}}">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <button class="modal-close icofont-close" data-bs-dismiss="modal"></button>
                                            <div class="product-view">
                                                <div class="row">
                                                    <div class="col-md-6 col-lg-6">
                                                        <div class="view-gallery">
                                                            <div class="view-label-group">
                                                                <label class="view-label new"
                                                                    id="stock-label-{{product['product_id']}}">{{product['stock']}}
                                                                    in
                                                                    stock</label>
                                                            </div>
                                                            <ul class="preview-slider">
                                                                <li><img src="static/images/product-images/{{product['image']}}"
                                                                        alt="product"></li>
                                                            </ul>

                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 col-lg-6">
                                                        <div class="view-details">
                                                            <h3 class="view-name">
                                                                <a href="">{{product['name']}}</a>
                                                            </h3>
                                                            <div class="view-meta">
                                                                <p>Location:<span>{{product['location']}}</span></p><br>
                                                                <p>Plant Type: {{product['plant_type']}}</p><br>
                                                                <p>When to Water: {{product['watering']}}</p>
                                                            </div>
                                                            <h3 class="view-price">
                                                                <!-- <del>{{product[11]}}</del> -->
                                                                <span>${{product['price']}}</span>
                                                            </h3>
                                                            <p class="view-desc">{{product['description']}}</p>

                                                            <div>
                                                                {% if product['stock'] > 0 %}
                                                                <div class="view-add-group">
                                                                    <button class="product-add" title="Add to Cart">
                                                                        <span>Tap to add amount</span>
                                                                    </button>
                                                                    <div class="product-action">
                                                                        <button class="custom-quantity-minus"
                                                                            title="Quantity Minus">
                                                                            <i class="icofont-minus"></i>
                                                                        </button>

                                                                        <input
                                                                            class="custom-quantity-input action-input"
                                                                            title="Quantity Number" type="text"
                                                                            name="quantity" value="1" min="1"
                                                                            max="{{product['stock']}}">

                                                                        <button class="custom-quantity-plus"
                                                                            title="Quantity Plus">
                                                                            <i class="icofont-plus"></i>
                                                                        </button>
                                                                    </div>



                                                                </div>
                                                                <div class="view-action-group">
                                                                    <a class="view-wish wish" href="/shop"
                                                                        title="Add to Cart">
                                                                        <i class="fas fa-shopping-cart"></i>
                                                                        <span>add to cart</span>
                                                                    </a>
                                                                </div>
                                                                {% else %}
                                                                <p style="color:red">Out of Stock</p>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--=====================================
                    SHOP PART END
        =======================================-->



    <!--=====================================
                     FOOTER PART START
        =======================================-->
    {% include 'footer.html' %}
    <!--=====================================
                      FOOTER PART END
        =======================================-->


    <!--=====================================
                    JS LINK PART START
        =======================================-->
    <!-- VENDOR -->
    <script src="{{url_for('static', filename='vendor/bootstrap/jquery-1.12.4.min.js')}}"></script>
    <script src="{{url_for('static', filename='vendor/bootstrap/popper.min.js')}}"></script>
    <script src="{{url_for('static', filename='vendor/bootstrap/bootstrap.min.js')}}"></script>
    <script src="{{url_for('static', filename='vendor/countdown/countdown.min.js')}}"></script>
    <script src="{{url_for('static', filename='vendor/niceselect/nice-select.min.js')}}"></script>
    <script src="{{url_for('static', filename='vendor/slickslider/slick.min.js')}}"></script>
    <script src="{{url_for('static', filename='vendor/venobox/venobox.min.js')}}"></script>

    <!-- CUSTOM -->
    <script src="{{url_for('static', filename='js/nice-select.js')}}"></script>
    <script src="{{url_for('static', filename='js/countdown.js')}}"></script>
    <script src="{{url_for('static', filename='js/accordion.js')}}"></script>
    <script src="{{url_for('static', filename='js/venobox.js')}}"></script>
    <script src="{{url_for('static', filename='js/slick.js')}}"></script>
    <script src="{{url_for('static', filename='js/main.js')}}"></script>

    <script>
        //This script caps the amount of items you can buy
        document.addEventListener("DOMContentLoaded", function () {
            function enforceMinMax(element) {
                if (element.value !== "") {
                    if (parseInt(element.value) < parseInt(element.min)) {
                        element.value = element.min;
                    }
                    if (parseInt(element.value) > parseInt(element.max)) {
                        element.value = element.max;
                    }
                }
            }

            function decreaseQuantity(event) {
                let inputElement = event.target.closest('.product-action').querySelector(".custom-quantity-input");
                let currentValue = parseInt(inputElement.value);
                if (currentValue > parseInt(inputElement.min)) {
                    inputElement.value = currentValue - 1;
                }
            }

            function increaseQuantity(event) {
                let inputElement = event.target.closest('.product-action').querySelector(".custom-quantity-input");
                let currentValue = parseInt(inputElement.value);
                if (currentValue < parseInt(inputElement.max)) {
                    inputElement.value = currentValue + 1;
                }
            }

            let minusButtons = document.querySelectorAll(".custom-quantity-minus");
            let plusButtons = document.querySelectorAll(".custom-quantity-plus");
            let inputElements = document.querySelectorAll(".custom-quantity-input");

            minusButtons.forEach(function (minusButton) {
                minusButton.addEventListener("click", decreaseQuantity);
            });

            plusButtons.forEach(function (plusButton) {
                plusButton.addEventListener("click", increaseQuantity);
            });

            inputElements.forEach(function (inputElement) {
                inputElement.addEventListener("keyup", function () {
                    enforceMinMax(this);
                });
            });
        });

    </script>

    <script>
        // This script handles the filters

        // Checkmarks all who are in the parameters
        function setCheckedState(inputElements, values) {
            inputElements.forEach((input) => {
                if (values.includes(input.value)) {
                    input.checked = true;
                }
            });
        }

        // Order By defaults to ascending
        let defaultRadio = document.getElementById("order-1");
        defaultRadio.checked = true;

        const form = document.getElementById("filters-form");
        const filterButtons = form.querySelectorAll('button[type="submit"]');

        const urlSearchParams = new URLSearchParams(window.location.search);

        // Extract all parameters from URL
        const locations = urlSearchParams.getAll("locations");
        const plantTypes = urlSearchParams.getAll("plant-types");
        const sunExposures = urlSearchParams.getAll("sun-exps");
        const waterings = urlSearchParams.getAll("waterings");
        const sortings = urlSearchParams.getAll("sortings");
        const orderBy = urlSearchParams.getAll("sorting-order");


        // Fill checkmarks
        setCheckedState(form.querySelectorAll('input[name="locations"]'), locations);
        setCheckedState(form.querySelectorAll('input[name="plant-types"]'), plantTypes);
        setCheckedState(form.querySelectorAll('input[name="sun-exps"]'), sunExposures);
        setCheckedState(form.querySelectorAll('input[name="waterings"]'), waterings);
        setCheckedState(form.querySelectorAll('input[name="sortings"]'), sortings);
        setCheckedState(form.querySelectorAll('input[name="sorting-order"]'), orderBy);

        form.addEventListener("submit", function (event) {
            event.preventDefault();

            const clickedButtonValue = event.submitter.value;
            const searchParams = new URLSearchParams(window.location.search);

            if (clickedButtonValue === "all") {
                // Add values of all checkboxes and radio buttons to the searchParams
                form
                    .querySelectorAll("input[type='checkbox'], input[type='radio']")
                    .forEach((input) => {
                        if (input.checked && input.name === "sorting-order") {
                            searchParams.delete(input.name);
                        }
                        if (input.checked && !searchParams.getAll(input.name).includes(input.value)) {
                            searchParams.append(input.name, input.value);
                        }
                        if (!input.checked && searchParams.getAll(input.name).includes(input.value)) {
                            searchParams.delete(input.name, input.value);
                        }
                    });
            } else {
                // Add values of checkboxes and radio buttons within the same category to the searchParams
                const categoryDiv = event.submitter.closest(".shop-widget");
                categoryDiv
                    .querySelectorAll("input[type='checkbox'], input[type='radio']")
                    .forEach((input) => {
                        if (input.checked && input.name === "sorting-order") {
                            searchParams.delete(input.name);
                        }

                        if (input.checked && !searchParams.getAll(input.name).includes(input.value)) {
                            searchParams.append(input.name, input.value);
                        }
                        if (!input.checked && searchParams.getAll(input.name).includes(input.value)) {
                            searchParams.delete(input.name, input.value);
                        }
                    });
            }
            window.location.href = `/shop?${searchParams.toString()}`;
        });
    </script>

    <script>
        function myFunc(e) {
            e.preventDefault();
        }
    </script>

    <!--=====================================
                    JS LINK PART END
        =======================================-->
</body>

</html>